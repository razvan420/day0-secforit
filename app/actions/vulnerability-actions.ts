'use server'

export async function refreshVulnerabilityFeed() {
  try {
    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000';
    const response = await fetch(`${baseUrl}/rss`, {
      method: 'GET',
      cache: 'no-store'
    });
    
    return { success: true, status: response.status };
  } catch (error) {
    console.error('Error refreshing feed:', error);
    return { success: false, error: 'Failed to refresh feed' };
  }
}

export async function getVulnerabilityStats() {
  try {
    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000';
    const response = await fetch(`${baseUrl}/rss`, {
      cache: 'no-store'
    });
    
    const content = await response.text();
    const itemCount = (content.match(/<item>/g) || []).length;
    
    return {
      success: true,
      totalVulnerabilities: itemCount,
      lastUpdated: new Date().toISOString()
    };
  } catch (error) {
    return { success: false, error: 'Failed to get stats' };
  }
}